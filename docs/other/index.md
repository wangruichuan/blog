## 性能优化，前端能做的不多

我们在前端面试的时候，这个性能优化是一个必考的问题，然后面试的时候会问你性能优化的方式，然后你还需要去准备一下，像八股文一样去背诵，去想一下项目中应用的场景对吧。但是有没有发现一个问题，面试虽然在问，但是实际工作中，你性能优化的场景或者说机会到底有多少？真实的一些工作场景其实并不多对吧，所以说，面试和工作其实是一对矛盾，面试造火箭，工作拧螺丝是一种常态。

我想说的是，在实际工作中，性能优化，前端能做的不多，我们来详细分析一下这个性能优化，在实际工作中，我们需要做的其实无非就这么几个：**拆分、异步、缓存**

对于缓存，比如说vue的computed，还有react的useMemo，这些。其实这些缓存用的并不多，有哪些场景是必须用的吗，大量计算的场景其实非常少，这种场景其实并不多。

拆分就是说你的JS包比较大，然后你拆分出来，一般配合着异步加载的，其实一个项目不是特别大，达到了几M这么大，你拆不拆分影响都不是很大。比如说你拆分之后JS的包减少了100KB，一般来说我们如果网络非常好再配合这个CDN加持，这个100KB的体积基本上是看不出来的，所以说，在网络、CDN和浏览器的一些缓存策略的加持下，这100kb基本上是看不出什么区别来的。还有就是现在TCP传输都会有压缩，比如说常见的这种GZIP压缩，一般会压缩到原本的三分之一大小，所以说，你看似优化了100kb，实际上真正优化的也就30kb。所以说前端的这种拆分资源，减少资源的优化方式在整个网络、缓存包括压缩CDN这种技术面前，其实是看不出来什么区别的，所以说大部分情况下你用压缩，拆分看不出来区别。

也就是一个web系统，你从全栈的角度去看的话，它的性能瓶颈不可能在前端。一般情况下会在网络层面和服务端，网络层面就比如说你的网络是不是就近部署的，有没有用CDN。后端因为数据库的存在，对于数据库表的设计啊，加密等要求，导致没有一个统一的解决方案，所以说前端很少会成为这个全栈项目的性能瓶颈。

当然，前端不能做性能优化。但是，我们可以通过一些手段去做体验优化，这个也是非常重要的一点，就比如说这种图片懒加载，可能会让你浏览更丝滑等等。



## 如何实现精确的setInterval（待完善）

https://www.bilibili.com/video/BV1Dm62YZEeS/?spm_id_from=333.1387.favlist.content.click&vd_source=d6026c8520318ca0d70d62989ee23568

谈这个问题前，你得首先搞懂清楚setTimeout为什么不是完全精准的定时器。其实这考的还是事件循环。

1. 事件循环影响回调时机，如果有同步阻塞的话，这个肯定是精确不了的
2. 4ms最小时间(嵌套五层以上以后)
3. 失活页面间隔会被调整为1s

这里给出解决方案：
1. 通过```performance.now```调整偏差：每次回调运行的时候调整这个偏差，调整一下时间间隔
2. ```requestAnimationFrame```：渲染帧
3. ```web worker```

## 写业务vs写框架

通过一个vue源码里的一个工具函数去体会：

vue源码有一个工具方法：```hasChanged```，传入两个参数x,y，判断x到y是否变化，再直白一点，x和y是否一样，一样就返回false。

那可能会说，这岂不是太简单了？直接用===就行啊？确实，如果我们写业务代码，这样写，这个系统运行一百年可能也不会挂，但是由于这是框架代码，他要给不同的业务系统去使用的，那这件事就说不好了，因为站在框架层面，它面对的业务场景是无穷无限的。

比如说，我要判断一个数是不是奇数，如果是业务代码的话，那你就直接判断 ``` x % 2 === 1```，直接判断奇数对吧，完全不用去考虑什么小数，负数的问题。

那站在公共库和框架的层面， 那这件事就很值得商榷了，你不得不去考虑那些更加刁钻的情况，上面这行代码，看上去没问题，我们来看一下vue官方是怎么写的。

![image](https://img.picgo.net/2025/07/28/image9678cd50faaa364f.png)

这里我们就要去仔细去探讨一下 === 这个操作符，有没有可能，两个东西通过严格相等它为真，有没有可能，他们是不同的东西。其实是有的，那就是  +0和-0。

![image](https://img.picgo.net/2025/07/28/image7a03a0002c71275f.png)

在JS中，+0 和 -0表现出来的特点是不一样：1/+0为正无穷，1/-0为负无穷。所以它这里在消除+0与-0的差异。

有没有可能，两个东西通过严格相等它为负，有没有可能，他们是相同的东西。其实是有的，那就是  那就是NaN。

所以else分支在消除NaN的情况。

其实vue这么做是为了兼容es5以下的环境，在es6之后，直接用```Object.is```就行，它把 +0，-0，NaN的情况全部兼容了。

![image](https://img.picgo.net/2025/07/28/imagedbc165cd1151719c.png)

好，今天又学到了一个小技巧。

害，我这又爱又恨的JS呀~~~


## 不同域名下的同步登录

最近公司里有一个需求，公司现在接的有很多通州区的系统项目，包括项目平台，数据平台...

需求就是：不同域名，但是请求同一个接口地址，一个登录了，其他的怎么也获取登录状态。就是一个站点登录成功了，其他站点也得登录成功。

当时我第一反应想到 长连接或者轮询，要么就websocket。然后咨询了后端的技术leader，给我推荐了一种方案，之前他们这样做的，我分享一下：

客户端给服务器发送请求了之后，登录成功之后，不仅会带一个token，还会下发一个临时id，类似jwt这种东西，
然后客户端需要内部开一个iframe窗口去不断的访问其他域名，把这个id通过地址栏参数带过去，必须得让服务器知道你是谁。服务器会去验证id是否正确，正确率就会派发token，在本地保存。

## SlideV ：为开发者打造的PPT工具

官网：https://cn.sli.dev/


### 全局安装

![](https://pic1.imgdb.cn/item/6889c45258cb8da5c8efd5a3.png)

Slidev 的幻灯片以 Markdown 的格式编写。一个md文件即是一个ppt文件

### 项目启动

1. 新建```hello.md```
2. 在该目录 命令行输入 ```slidev hello.md```
3. 浏览器访问 [http://localhost:3000](http://localhost:3000)

### 主题

https://cn.sli.dev/resources/theme-gallery


![](https://pic1.imgdb.cn/item/6889c77658cb8da5c8efe400.png)


### 演讲者模式
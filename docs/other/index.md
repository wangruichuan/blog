## 记录一次腾讯的开源经历 -- cherry-markdown

### 背景

起初，我是在知乎的一个回答下看到的腾讯犀牛鸟开源计划。

官网： https://opensource.tencent.com/summer-of-code

腾讯主导的开源活动，看了下，做的项目也主要是腾讯的开源项目，分为 issue 解决和参与课题两种方式。

培养模式如下：

![](https://pic1.imgdb.cn/item/689023f158cb8da5c8021419.png)

### 项目介绍

看了下这个计划下的项目，作为一个前端工程师，我看了下，我大概能参与这几个：

1. 腾讯文档：有一说一，我一直都想研究下这种协同文档是怎么做的，只知道是用的websocket实时更新，在公司里用的金山文档比较多，这种文档是用SVG纯绘制的，而且经常会有目录无法更新跳转的bug，所以说，对于这个项目，我最开始的感受是挺有技术含量的。

![](https://pic1.imgdb.cn/item/68902df958cb8da5c80253bf.png)

2. TDesign：前端通用 UI 组件库：
   
    这个是个组件库项目，官网文档：https://tdesign.tencent.com/vue/overview
   

    ![](https://pic1.imgdb.cn/item/689026ea58cb8da5c8022950.png)


    有vue2、vue3、React，还有移动端、小程序、flutter的版本。
    
    那挺好的，因为不像element ui 那种是仅限于 toB的各种web端的中后台管理系统，TDesign 这种多端、小程序、flutter的版本，可以做到样式更加通用，风格更加统一。
    
    因为自己的技术栈是vue，就看了下vue最常用的那几个组件，表单，table 等等，封装的方式还是挺现代的，因为自己经常对element ui进行二次封装，像TDesign直接就是类似于我二次封装后的版本，那这个就挺好，不过这个都是双刃剑，封装的越多，自定义的机会就越少。
    
    那我对于这种组件库项目的话，还是做的比较多了，在这种组件库项目中其实可以学到对于整个项目的架构（pnpm + monorepo）与各种工程化知识，封装的各种技巧，以及npm的发包更新等等，将来如果以后有机会可以自己在公司去维护组织一个这样的组件库，也挺好的，不过感觉各位前端工程师对于组件库这种东西还是自己顺手的用的多。

3. Cherry Markdown：Javascript Markdown 编辑器。
   在线体验：https://tencent.github.io/cherry-markdown/examples/index.html

   ![](https://pic1.imgdb.cn/item/6890287658cb8da5c8022b9b.png)
   
   这个就是一个无关框架的markdown编辑器组件，我看到这个时，我感觉很适合，因为自己本身曾经就是有基于Monaco editor去二次封装过的vue3 markdown编辑器组件，这种组件的一个核心流程就是 markdown -> ast -> html 。
   
   那我去深入了解了一下，发现这个编辑器的功能也太多了，能够看到经过了非常多的迭代优化，复杂度很大，我觉得这个项目我可以作为第一选项，然后我去报名了一个issue，尝试去clone下来，改了下取色器工具栏的样式，提了个PR。
   
   虽然最后没有采用，但也算是了解了这个项目结构。

    ![](https://pic1.imgdb.cn/item/6890291558cb8da5c8022fb9.png)

    ![](https://pic1.imgdb.cn/item/6890293b58cb8da5c80230bb.png)
   


4. OMI：Web Components框架
![](https://pic1.imgdb.cn/item/68902aa858cb8da5c8023f02.png)

Web Components其实是老生常谈了，自己只是写过几个demo，并不知道实际的项目中该如何运用，对于Web Components框架，我印象中最有名的是谷歌的Lit​，这里是元宝给的介绍。

![](https://pic1.imgdb.cn/item/68902b4158cb8da5c80242f2.png)

咋说呢，在大家都在用Vue，React的情况下，组件化的思想早已经深入人心，尤大在之前的演讲or分享中也有提到过，vue的组件化其实是比较向web components靠拢的，对于这一块，腾讯作为这么大的一个公司，各种方向肯定是要去涉及的，所以有这么一个框架也是有存在的必要，这里我的想法是可以去了解，扩充下知识。

------------------------

还有个PureTS的项目，我看了下项目介绍：

PuerTS是腾讯游戏团队打造的 Unity/Unreal/Dotnet 下的TypeScript编程解决方案：
1、提供了一个JavaScript运行时
2、提供TypeScript声明文件生成能力，易于通过TypeScript访问宿主引擎

看了下需要的技术栈，我发现我只会JS/TS，这里还要求精通Kotlin，Python，wasm3，C++....

这个项目确实是有价值，但是对于我而言，太难了，遂放弃。


### 项目报名
七月中旬我就提交了项目申报书，里面有自己的一些经历与简历，后来就因为实习的事情没去看，然后七月底的时候收到邮件告诉我已经成功入选了，然后我就按照提示进入了这个实战群里。

![](https://pic1.imgdb.cn/item/68902cd958cb8da5c8024ce1.png)


### Cherry Markdown Writer 项目剖析

![界面](https://pic1.imgdb.cn/item/6890629d58cb8da5c803d3e0.png)



#### markdown语法相关实现


#### 待实现
1. 图片双击预览

## 性能优化，前端能做的不多

我们在前端面试的时候，这个性能优化是一个必考的问题，然后面试的时候会问你性能优化的方式，然后你还需要去准备一下，像八股文一样去背诵，去想一下项目中应用的场景对吧。但是有没有发现一个问题，面试虽然在问，但是实际工作中，你性能优化的场景或者说机会到底有多少？真实的一些工作场景其实并不多对吧，所以说，面试和工作其实是一对矛盾，面试造火箭，工作拧螺丝是一种常态。

我想说的是，在实际工作中，性能优化，前端能做的不多，我们来详细分析一下这个性能优化，在实际工作中，我们需要做的其实无非就这么几个：**拆分、异步、缓存**

对于缓存，比如说vue的computed，还有react的useMemo，这些。其实这些缓存用的并不多，有哪些场景是必须用的吗，大量计算的场景其实非常少，这种场景其实并不多。

拆分就是说你的JS包比较大，然后你拆分出来，一般配合着异步加载的，其实一个项目不是特别大，达到了几M这么大，你拆不拆分影响都不是很大。比如说你拆分之后JS的包减少了100KB，一般来说我们如果网络非常好再配合这个CDN加持，这个100KB的体积基本上是看不出来的，所以说，在网络、CDN和浏览器的一些缓存策略的加持下，这100kb基本上是看不出什么区别来的。还有就是现在TCP传输都会有压缩，比如说常见的这种GZIP压缩，一般会压缩到原本的三分之一大小，所以说，你看似优化了100kb，实际上真正优化的也就30kb。所以说前端的这种拆分资源，减少资源的优化方式在整个网络、缓存包括压缩CDN这种技术面前，其实是看不出来什么区别的，所以说大部分情况下你用压缩，拆分看不出来区别。

也就是一个web系统，你从全栈的角度去看的话，它的性能瓶颈不可能在前端。一般情况下会在网络层面和服务端，网络层面就比如说你的网络是不是就近部署的，有没有用CDN。后端因为数据库的存在，对于数据库表的设计啊，加密等要求，导致没有一个统一的解决方案，所以说前端很少会成为这个全栈项目的性能瓶颈。

当然，前端不能做性能优化。但是，我们可以通过一些手段去做体验优化，这个也是非常重要的一点，就比如说这种图片懒加载，可能会让你浏览更丝滑等等。


## 写业务vs写框架

通过一个vue源码里的一个工具函数去体会：

vue源码有一个工具方法：```hasChanged```，传入两个参数x,y，判断x到y是否变化，再直白一点，x和y是否一样，一样就返回false。

那可能会说，这岂不是太简单了？直接用===就行啊？确实，如果我们写业务代码，这样写，这个系统运行一百年可能也不会挂，但是由于这是框架代码，他要给不同的业务系统去使用的，那这件事就说不好了，因为站在框架层面，它面对的业务场景是无穷无限的。

比如说，我要判断一个数是不是奇数，如果是业务代码的话，那你就直接判断 ``` x % 2 === 1```，直接判断奇数对吧，完全不用去考虑什么小数，负数的问题。

那站在公共库和框架的层面， 那这件事就很值得商榷了，你不得不去考虑那些更加刁钻的情况，上面这行代码，看上去没问题，我们来看一下vue官方是怎么写的。

![image](https://img.picgo.net/2025/07/28/image9678cd50faaa364f.png)

这里我们就要去仔细去探讨一下 === 这个操作符，有没有可能，两个东西通过严格相等它为真，有没有可能，他们是不同的东西。其实是有的，那就是  +0和-0。

![image](https://img.picgo.net/2025/07/28/image7a03a0002c71275f.png)

在JS中，+0 和 -0表现出来的特点是不一样：1/+0为正无穷，1/-0为负无穷。所以它这里在消除+0与-0的差异。

有没有可能，两个东西通过严格相等它为负，有没有可能，他们是相同的东西。其实是有的，那就是  那就是NaN。

所以else分支在消除NaN的情况。

其实vue这么做是为了兼容es5以下的环境，在es6之后，直接用```Object.is```就行，它把 +0，-0，NaN的情况全部兼容了。

![image](https://img.picgo.net/2025/07/28/imagedbc165cd1151719c.png)

好，今天又学到了一个小技巧。

害，我这又爱又恨的JS呀~~~


## 不同域名下的同步登录

最近公司里有一个需求，公司现在接的有很多通州区的系统项目，包括项目平台，数据平台...

需求就是：不同域名，但是请求同一个接口地址，一个登录了，其他的怎么也获取登录状态。就是一个站点登录成功了，其他站点也得登录成功。

当时我第一反应想到 长连接或者轮询，要么就websocket。然后咨询了后端的技术leader，给我推荐了一种方案，之前他们这样做的，我分享一下：

客户端给服务器发送请求了之后，登录成功之后，不仅会带一个token，还会下发一个临时id，类似jwt这种东西，
然后客户端需要内部开一个iframe窗口去不断的访问其他域名，把这个id通过地址栏参数带过去，必须得让服务器知道你是谁。服务器会去验证id是否正确，正确率就会派发token，在本地保存。


## 请求竞态(请求乱序)
老生常谈了，原因是 请求的顺序不代表响应回来的顺序

最常见的一种场景：点分页时，分页数据还没回来之前，又点了第二个分页，此时第二个分页的数据先回来，第一次的才回来，导致现在页面上渲染的就是 第一页的数据，但是页码是2，这就是请求竞态，返回的顺序不确定。

参考视频： https://v.douyin.com/InTmdzeOjoY/ 
参考视频： https://www.bilibili.com/video/BV1t1T7zcEnA/

谈谈解决办法（）：
1. 最无脑的方法：请求分页数据的时候直接禁用分页功能或者加一个loading效果
2. 请求取消：发送2的时候如果1还没拿到结果，直接取消掉1这个请求。
   具体做法：在每次请求之前要做一下判断：在axios里：
      1. 声明一个缓存的集合
      2. 基于请求的url和method去生成一个key（判断两次是否是同一个请求）
      3. 把正在请求中的请求给缓存到集合中，也就是要缓存正在pending状态的请求

## 单点登录SSO

https://www.bilibili.com/video/BV1UaKtzdEzG/

需求背景：公司里有很多产品线，有很多系统，总不能每个系统都维护一套用户吧。因此需要对用户中心进行一个抽离，标准做法是CAS,OAuth2.0。但具体到技术层面，最终要么是Session + Cookie 模式，要么是双Token模式。

### Session + Cookie 模式
![](https://pic1.imgdb.cn/item/68a3048658cb8da5c831138f.png)

优势：强控制力，说让你下线就下线
缺点：成本太高了，认证中心压力很大，还要做session的集群，还要做容灾，因为认证中心一挂就全完了

### 单Token模式

![](https://pic1.imgdb.cn/item/68a3054c58cb8da5c83118ee.png)

1. 首先访问认证中心，拿到一个token，可以用jwt
2. 然后访问子系统时，子系统可以自行进行鉴权，不需要去询问认证中心

缺点：对用户的控制力在减弱，设置多久的过期时间呢？


### 双token模式
![](https://pic1.imgdb.cn/item/68a3067a58cb8da5c8312117.png)

![](https://pic1.imgdb.cn/item/68a306dd58cb8da5c83123cf.png)

登录之后。拿到两个token，一个是过期时间短的token，一个是过期时间长的token。

用户拿着这个短的token去拿资源，将来如果说过期时间到了。会拿着长token去访问认证中心去询问，你给我换一个短token。

其实咋回事呢，就是它希望用户每隔一小段时间来一次，方便我控制

## SlideV ：为开发者打造的PPT工具

官网：https://cn.sli.dev/


### 全局安装

![](https://pic1.imgdb.cn/item/6889c45258cb8da5c8efd5a3.png)

Slidev 的幻灯片以 Markdown 的格式编写。一个md文件即是一个ppt文件

### 项目启动

1. 新建```hello.md```
2. 在该目录 命令行输入 ```slidev hello.md```
3. 浏览器访问 [http://localhost:3000](http://localhost:3000)

### 主题

https://cn.sli.dev/resources/theme-gallery


![](https://pic1.imgdb.cn/item/6889c77658cb8da5c8efe400.png)


### 演讲者模式